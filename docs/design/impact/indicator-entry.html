<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nouvelle mesure &mdash; Repas servis &mdash; Libero NPO Platform</title>
  <link rel="stylesheet" href="../shared/tokens.css">
  <link rel="stylesheet" href="../shared/base.css">
  <style>
    /* ── Page-specific styles for impact/indicator-entry (IMP-002) ── */

    /* Two-column entry layout */
    .entry-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: var(--space-6);
    }

    .entry-col {
      display: flex;
      flex-direction: column;
      gap: var(--space-6);
    }

    /* Indicator read-only info block */
    .indicator-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-3) var(--space-6);
    }

    .indicator-info-item {
      display: flex;
      flex-direction: column;
      gap: var(--space-0-5);
    }

    .indicator-info-item .info-label {
      font-size: var(--text-xs);
      font-weight: var(--weight-medium);
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
    }

    .indicator-info-item .info-value {
      font-size: var(--text-sm);
      color: var(--color-text);
      font-weight: var(--weight-medium);
    }

    /* Large value input with unit label */
    .value-input-group {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    .value-input-group .form-input {
      height: 48px;
      font-size: var(--text-xl);
      font-family: var(--font-mono);
      font-weight: var(--weight-semi);
      max-width: 200px;
      text-align: right;
      padding: 0 var(--space-4);
    }

    .value-input-group .value-unit {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      font-weight: var(--weight-medium);
      white-space: nowrap;
    }

    /* Dashed file upload zone */
    .file-upload-zone {
      border: 2px dashed var(--color-neutral-300);
      border-radius: var(--radius-md);
      padding: var(--space-6) var(--space-4);
      text-align: center;
      cursor: pointer;
      transition: all var(--duration-normal) var(--ease-out);
      background: var(--color-neutral-50);
    }

    .file-upload-zone:hover {
      border-color: var(--color-primary);
      background: var(--color-primary-50);
    }

    .file-upload-zone .upload-icon {
      font-size: var(--text-xl);
      color: var(--color-text-muted);
      margin-bottom: var(--space-2);
    }

    .file-upload-zone .upload-text {
      font-size: var(--text-xs);
      color: var(--color-text-secondary);
    }

    /* Mini bar chart container */
    .mini-bar-chart {
      width: 100%;
      max-height: 120px;
    }

    .mini-bar-chart svg {
      width: 100%;
      height: 120px;
      display: block;
    }

    /* Small compact history table */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--text-xs);
    }

    .history-table td {
      padding: var(--space-1-5) 0;
      border-bottom: 1px solid var(--color-neutral-100);
    }

    .history-table td:first-child {
      color: var(--color-text-secondary);
    }

    .history-table td:last-child {
      text-align: right;
      font-family: var(--font-mono);
      font-weight: var(--weight-semi);
      color: var(--color-text);
    }

    .history-table tr:last-child td {
      border-bottom: none;
    }

    /* Search shortcut badge in topbar */
    .search-shortcut {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: var(--text-xs);
      color: var(--color-text-muted);
      background: var(--color-neutral-100);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      padding: 1px 6px;
      font-family: var(--font-mono);
      pointer-events: none;
    }

    .topbar-search {
      position: relative;
    }

    /* Sidebar org logo */
    .sidebar-footer-org-logo {
      width: 32px;
      height: 32px;
      background: rgba(255,255,255,0.15);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-xs);
      font-weight: var(--weight-bold);
      flex-shrink: 0;
    }

    /* AI card full-width override for right column */
    .entry-col .ai-card {
      max-width: 100%;
    }

    /* Average mention */
    .average-line {
      font-size: var(--text-xs);
      color: var(--color-text-secondary);
      font-weight: var(--weight-medium);
      margin-top: var(--space-3);
      padding-top: var(--space-3);
      border-top: 1px solid var(--color-neutral-100);
    }

    .average-line .average-value {
      font-family: var(--font-mono);
      font-weight: var(--weight-semi);
      color: var(--color-text);
    }

    /* Indicator name styling */
    .indicator-name {
      font-family: var(--font-heading);
      font-size: var(--text-xl);
      font-weight: var(--weight-regular);
      color: var(--color-text);
      margin-bottom: var(--space-4);
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .entry-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <div class="app-layout">

    <!-- ============================================================
         SIDEBAR
         ============================================================ -->
    <aside class="sidebar">

      <!-- Brand -->
      <div class="sidebar-brand">
        <div class="sidebar-brand-logo">L</div>
        <span class="sidebar-brand-text">Libero</span>
      </div>

      <!-- Navigation -->
      <nav class="sidebar-nav">
        <a href="../dashboard.html" class="nav-item">
          <span class="nav-item-icon">&#9634;</span>
          <span class="nav-item-label">Dashboard</span>
        </a>
        <a href="../constituents/list.html" class="nav-item">
          <span class="nav-item-icon">&#9775;</span>
          <span class="nav-item-label">Constituants</span>
        </a>
        <a href="../donations/list.html" class="nav-item">
          <span class="nav-item-icon">&#9829;</span>
          <span class="nav-item-label">Dons &amp; Campagnes</span>
        </a>
        <a href="../grants/list.html" class="nav-item">
          <span class="nav-item-icon">&#9733;</span>
          <span class="nav-item-label">Subventions</span>
        </a>
        <a href="../programs/list.html" class="nav-item">
          <span class="nav-item-icon">&#9670;</span>
          <span class="nav-item-label">Programmes</span>
        </a>
        <a href="../volunteers/list.html" class="nav-item">
          <span class="nav-item-icon">&#9996;</span>
          <span class="nav-item-label">B&#233;n&#233;voles</span>
        </a>
        <a href="#" class="nav-item active">
          <span class="nav-item-icon">&#9678;</span>
          <span class="nav-item-label">Impact</span>
        </a>
        <a href="#" class="nav-item">
          <span class="nav-item-icon">&#9993;</span>
          <span class="nav-item-label">Communications</span>
        </a>
        <a href="#" class="nav-item">
          <span class="nav-item-icon">&#9776;</span>
          <span class="nav-item-label">Rapports</span>
        </a>
        <a href="#" class="nav-item">
          <span class="nav-item-icon">&#9881;</span>
          <span class="nav-item-label">Param&#232;tres</span>
        </a>
      </nav>

      <!-- Footer -->
      <div class="sidebar-footer">
        <div class="sidebar-footer-org-logo">ASM</div>
        <div class="sidebar-footer-info">
          <div class="sidebar-footer-name">Association Solidarit&#233; M&#233;diterran&#233;e</div>
          <div class="sidebar-footer-role">Claire Dubois</div>
        </div>
        <div class="sidebar-footer-avatar">CD</div>
      </div>

    </aside>
    <!-- end .sidebar -->

    <!-- ============================================================
         MAIN WRAPPER
         ============================================================ -->
    <div class="main-wrapper">

      <!-- ── Topbar ── -->
      <header class="topbar">
        <nav class="topbar-breadcrumb" aria-label="Fil d'Ariane">
          <a href="#">Impact</a>
          <span class="topbar-breadcrumb-sep">&#8250;</span>
          <a href="#">Repas servis</a>
          <span class="topbar-breadcrumb-sep">&#8250;</span>
          <span class="topbar-breadcrumb-current">Nouvelle mesure</span>
        </nav>

        <div class="topbar-search">
          <input
            type="text"
            class="topbar-search-input"
            placeholder="Rechercher..."
          >
          <span class="search-shortcut">&#8984;K</span>
        </div>

        <div class="topbar-actions">
          <button class="topbar-icon-btn" title="Notifications" aria-label="Notifications">
            &#128276;
            <span class="notification-dot"></span>
          </button>
          <div class="topbar-avatar" title="Claire Dubois">CD</div>
        </div>
      </header>
      <!-- end .topbar -->

      <!-- ── Main Content ── -->
      <main class="main-content">

        <!-- ============================== -->
        <!--         Page Header             -->
        <!-- ============================== -->
        <div class="page-header">
          <div class="page-header-left">
            <h1 class="page-title">Saisir une mesure</h1>
            <p class="page-subtitle">Enregistrez une nouvelle valeur pour l'indicateur s&#233;lectionn&#233;.</p>
          </div>
          <div class="page-header-actions">
            <button class="btn btn-secondary" type="button">Annuler</button>
            <button class="btn btn-primary" type="button">Sauvegarder</button>
          </div>
        </div>

        <!-- ============================== -->
        <!--     Two-column entry grid       -->
        <!-- ============================== -->
        <div class="entry-grid">

          <!-- ──────────────────────────────────────────
               LEFT COLUMN (2fr) — Form
               ────────────────────────────────────────── -->
          <div class="entry-col">

            <!-- Card: Indicateur (read-only info) -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Indicateur</h3>
              </div>
              <div class="card-body">
                <div class="indicator-name">Repas servis</div>
                <div class="indicator-info">
                  <div class="indicator-info-item">
                    <span class="info-label">Unit&#233;</span>
                    <span class="info-value">nombre (repas)</span>
                  </div>
                  <div class="indicator-info-item">
                    <span class="info-label">Programme</span>
                    <span class="info-value">Aide alimentaire</span>
                  </div>
                  <div class="indicator-info-item">
                    <span class="info-label">Fr&#233;quence</span>
                    <span class="info-value">Mensuelle</span>
                  </div>
                  <div class="indicator-info-item">
                    <span class="info-label">Derni&#232;re valeur</span>
                    <span class="info-value">1 350 (janvier 2026)</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Card: Nouvelle mesure (form) -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Nouvelle mesure</h3>
              </div>
              <div class="card-body">

                <!-- Valeur -->
                <div class="form-group">
                  <label class="form-label form-label-required">Valeur</label>
                  <div class="value-input-group">
                    <input type="number" class="form-input" placeholder="0" value="1500">
                    <span class="value-unit">repas</span>
                  </div>
                </div>

                <!-- Période de référence -->
                <div class="form-group">
                  <label class="form-label form-label-required">P&#233;riode de r&#233;f&#233;rence</label>
                  <div class="form-row">
                    <select class="form-select">
                      <option>Janvier</option>
                      <option selected>F&#233;vrier</option>
                      <option>Mars</option>
                      <option>Avril</option>
                      <option>Mai</option>
                      <option>Juin</option>
                      <option>Juillet</option>
                      <option>Ao&#251;t</option>
                      <option>Septembre</option>
                      <option>Octobre</option>
                      <option>Novembre</option>
                      <option>D&#233;cembre</option>
                    </select>
                    <select class="form-select">
                      <option>2024</option>
                      <option>2025</option>
                      <option selected>2026</option>
                    </select>
                  </div>
                </div>

                <!-- Source des données -->
                <div class="form-group">
                  <label class="form-label form-label-required">Source des donn&#233;es</label>
                  <select class="form-select">
                    <option selected>Comptage interne</option>
                    <option>Registre distribution</option>
                    <option>Rapport partenaire</option>
                    <option>Estimation</option>
                  </select>
                </div>

                <!-- Notes / contexte -->
                <div class="form-group">
                  <label class="form-label">Notes / contexte</label>
                  <textarea class="form-textarea" rows="3" placeholder="Ajoutez des pr&#233;cisions sur cette mesure..."></textarea>
                </div>

                <!-- Pièce jointe -->
                <div class="form-group">
                  <label class="form-label">Pi&#232;ce jointe</label>
                  <div class="file-upload-zone">
                    <div class="upload-icon">&#128206;</div>
                    <div class="upload-text">Glissez un fichier ou cliquez pour parcourir</div>
                  </div>
                </div>

              </div>

              <!-- Card footer with actions -->
              <div class="card-footer">
                <button class="btn btn-secondary" type="button">Annuler</button>
                <button class="btn btn-primary" type="button">Sauvegarder</button>
              </div>
            </div>

          </div>
          <!-- END LEFT COLUMN -->

          <!-- ──────────────────────────────────────────
               RIGHT COLUMN (1fr)
               ────────────────────────────────────────── -->
          <div class="entry-col">

            <!-- Card: Historique des mesures (mini trend chart) -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">&#201;volution r&#233;cente</h3>
              </div>
              <div class="card-body">

                <!-- Mini SVG bar chart -->
                <div class="mini-bar-chart">
                  <svg viewBox="0 0 240 120" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                    <!-- Grid lines -->
                    <line x1="20" y1="10" x2="230" y2="10" stroke="#E4E0D9" stroke-width="0.5" stroke-dasharray="2,2"/>
                    <line x1="20" y1="35" x2="230" y2="35" stroke="#E4E0D9" stroke-width="0.5" stroke-dasharray="2,2"/>
                    <line x1="20" y1="60" x2="230" y2="60" stroke="#E4E0D9" stroke-width="0.5" stroke-dasharray="2,2"/>
                    <line x1="20" y1="85" x2="230" y2="85" stroke="#E4E0D9" stroke-width="0.5" stroke-dasharray="2,2"/>

                    <!-- Average line (1220) at ~y42 -->
                    <line x1="20" y1="42" x2="230" y2="42" stroke="#D97706" stroke-width="1" stroke-dasharray="4,3" opacity="0.6"/>

                    <!-- Bars: max 1350 mapped to height 75, base at y=90 -->
                    <!-- Sep: 1100 => h=61 => y=29 -->
                    <rect x="25" y="29" width="26" height="61" rx="3" fill="#4CAF82"/>
                    <!-- Oct: 1200 => h=67 => y=23 -->
                    <rect x="60" y="23" width="26" height="67" rx="3" fill="#4CAF82"/>
                    <!-- Nov: 1150 => h=64 => y=26 -->
                    <rect x="95" y="26" width="26" height="64" rx="3" fill="#4CAF82"/>
                    <!-- Déc: 1300 => h=72 => y=18 -->
                    <rect x="130" y="18" width="26" height="72" rx="3" fill="#4CAF82"/>
                    <!-- Jan: 1350 => h=75 => y=15 -->
                    <rect x="165" y="15" width="26" height="75" rx="3" fill="#2E7D5E"/>
                    <!-- Fév: empty/dotted placeholder -->
                    <rect x="200" y="15" width="26" height="75" rx="3" fill="none" stroke="#A8A29E" stroke-width="1.5" stroke-dasharray="4,3" opacity="0.5"/>

                    <!-- Baseline -->
                    <line x1="20" y1="90" x2="230" y2="90" stroke="#D1CCC4" stroke-width="1"/>

                    <!-- Labels -->
                    <text x="38" y="103" text-anchor="middle" font-size="8" fill="#6B6760" font-family="Inter, sans-serif">Sep</text>
                    <text x="73" y="103" text-anchor="middle" font-size="8" fill="#6B6760" font-family="Inter, sans-serif">Oct</text>
                    <text x="108" y="103" text-anchor="middle" font-size="8" fill="#6B6760" font-family="Inter, sans-serif">Nov</text>
                    <text x="143" y="103" text-anchor="middle" font-size="8" fill="#6B6760" font-family="Inter, sans-serif">D&#233;c</text>
                    <text x="178" y="103" text-anchor="middle" font-size="8" fill="#6B6760" font-family="Inter, sans-serif">Jan</text>
                    <text x="213" y="103" text-anchor="middle" font-size="8" fill="#A8A29E" font-family="Inter, sans-serif">F&#233;v</text>

                    <!-- Value labels above bars -->
                    <text x="38" y="25" text-anchor="middle" font-size="7" fill="#4A4742" font-family="JetBrains Mono, monospace" font-weight="500">1100</text>
                    <text x="73" y="19" text-anchor="middle" font-size="7" fill="#4A4742" font-family="JetBrains Mono, monospace" font-weight="500">1200</text>
                    <text x="108" y="22" text-anchor="middle" font-size="7" fill="#4A4742" font-family="JetBrains Mono, monospace" font-weight="500">1150</text>
                    <text x="143" y="14" text-anchor="middle" font-size="7" fill="#4A4742" font-family="JetBrains Mono, monospace" font-weight="500">1300</text>
                    <text x="178" y="11" text-anchor="middle" font-size="7" fill="#1A5240" font-family="JetBrains Mono, monospace" font-weight="600">1350</text>
                    <text x="213" y="11" text-anchor="middle" font-size="7" fill="#A8A29E" font-family="Inter, sans-serif">?</text>
                  </svg>
                </div>

                <!-- Small history table -->
                <table class="history-table mt-4">
                  <tbody>
                    <tr>
                      <td>Sep 2025</td>
                      <td>1 100</td>
                    </tr>
                    <tr>
                      <td>Oct 2025</td>
                      <td>1 200</td>
                    </tr>
                    <tr>
                      <td>Nov 2025</td>
                      <td>1 150</td>
                    </tr>
                    <tr>
                      <td>D&#233;c 2025</td>
                      <td>1 300</td>
                    </tr>
                    <tr>
                      <td>Jan 2026</td>
                      <td>1 350</td>
                    </tr>
                  </tbody>
                </table>

                <!-- Average mention -->
                <div class="average-line">
                  Moyenne 6 mois : <span class="average-value">1 220</span>
                </div>
              </div>
            </div>

            <!-- AI Anomaly Detection Card -->
            <div class="ai-card">
              <div class="ai-card-header">
                <span class="ai-card-icon">&#9888;</span>
                <span class="ai-card-label">D&#233;tection d'anomalie</span>
              </div>
              <p class="ai-card-text">
                La valeur saisie (1 500) est 3&#215; sup&#233;rieure &#224; la moyenne des 6 derniers mois (1 220). Cela pourrait indiquer une erreur de saisie ou un &#233;v&#233;nement exceptionnel.
              </p>
              <p class="ai-card-text text-xs" style="margin-bottom: var(--space-3); color: var(--color-text-secondary);">
                V&#233;rifiez la source des donn&#233;es avant de sauvegarder.
              </p>
              <div class="ai-card-actions">
                <button class="btn btn-primary btn-sm" type="button">Confirmer la valeur</button>
                <button class="btn btn-ghost btn-sm" type="button">Corriger</button>
              </div>
            </div>

          </div>
          <!-- END RIGHT COLUMN -->

        </div>
        <!-- END ENTRY GRID -->

      </main>
      <!-- end .main-content -->

    </div>
    <!-- end .main-wrapper -->

  </div>
  <!-- end .app-layout -->

</body>
</html>
